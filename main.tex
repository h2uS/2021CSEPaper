\documentclass[11pt]{article}
\usepackage[a4paper,left=30mm,right=30mm,top=30mm,bottom=30mm]{geometry}
\usepackage{setspace}
\usepackage[utf8]{inputenc}
\usepackage{kotex}
\usepackage{amsmath}
\usepackage{forest}
\usepackage{booktabs}
\usepackage{titling}
\newcommand{\subtitle}[1]{%
	\posttitle{%
		\par\end{center}
	\begin{center}\large#1\end{center}
	\vskip0.1em}}%

\title{이산균등분포로부터 임의의 확률분포를 만들어내는\\시행 규칙 생성 알고리즘 연구}
\subtitle{보드게임에서의 확률적 요소 구현에 관하여}
\author{서희원}
\date{May 2021}

\begin{document}

\maketitle
\doublespacing

\section{Introduction}
한국콘텐츠진흥원에서는 매년 게임콘텐츠 제작지원 사업을 진행하고 있다. 2021년 게임콘텐츠 제작지원 사업안내서를 살펴보면 제작지원 대상 분야로 `보드게임'이 신시장창출형 부문에 포함되어 있다는 것\cite{contents2021}을 확인할 수 있는데, 이를 통해 최근까지도 보드게임에 대해 시장창출이 가능한 수준의 지속적인 수요가 존재한다는 사실을 알 수 있다. 또한 보드게임은 기획 및 개발의 진입장벽이 컴퓨터 프로그래밍이 필수적으로 요구되는 전자게임에 비하면 낮은 편이며, 이를 통해 게임 콘텐츠 창작을 목적으로 한 보드게임 제작 활동이 꾸준히 이루어지고 있음을 짐작할 수 있다.

프랑스의 사상가 로제 카이와(Roger Caillois)는 그의 저서에서 인간이 놀이로부터 재미를 느끼는 근본적인 원리를 4가지 범주로 정리하여 제시하였다.\cite{roger} 4가지 범주 중 하나인 알레아(Alea)는 우연, 운을 기반으로 하는 놀이를 포함하는 범주이며 확률적으로 이득이나 손해를 보는 구조를 통해 인간이 재미를 느낄 수 있다는 사실을 나타낸다. 이는 오늘날까지도 게임 기획 및 제작에 있어 큰 영향을 미치고 있고, 실제로 일일히 나열하기 어려울 정도로 수많은 게임에서 확률적, 무작위적 요소를 사용하고 있다.

전자기기를 이용하여 실행하고 즐기는 전자게임과 달리 보드게임은 현실에서 실제 사물을 정해진 규칙에 따라 조작하는 형태로 즐기게 되는데, 이는 보드게임 창작자가 알레아의 실현, 다시 말해 확률적 요소의 구현에 있어 큰 어려움을 느끼도록 만드는 원인이 된다. 7\% 확률로 당첨이 되는 상황을 구현해야 한다고 생각해보자. 전자게임에서는 난수생성을 활용하는 방식으로 해당 상황을 쉽게 구현할 수 있지만, 보드게임에서는 그렇지 않다. 별도의 전자기기를 준비물로 두지 않고 동전이나 카드, 주사위 등 보드게임에서 주로 사용하는 도구만을 가지고 이러한 상황을 구현하는 것은 간단한 일이 아니다.

이 글에서는 전자기기를 준비물로 두지 않고 주사위 등의 한정된 도구만 가지고서 확률적 요소를 구현하는 방법에 대해서 다룰 것이다. 해당 상황을 수학적으로 분석하여 문제를 정의하고 이를 해결할 것이며, 도출된 결과를 바탕으로 사용 가능한 프로그램을 제작한 뒤 이에 대해서도 정리할 것이다.

\section{Background}
\subsection{Discrete Uniform Distribution}
육면체 주사위를 던져서 1부터 6까지의 숫자 중 하나를 얻는 상황을 생각해보자. 주사위를 던져 얻은 숫자를 이산확률변수(discrete random variable) \textit{X}로 둘 수 있으며, 주사위의 각 면이 나올 확률이 모두 동일하여 \textit{X}가 1부터 6까지 각각의 값이 될 확률이 모두 동일한 경우 \textit{X}가 이산균등분포(discrete uniform distribution)을 따른다고 한다.

발생확률이 동일한 \textit{k}개의 근원사건(elementary event)으로 구성된 이산표본공간(discrete sample space)에서 각 근원사건에 대해 1부터 \textit{k}까지 차례대로 번호를 붙이고, 한 번의 시행 결과 발생한 사건의 번호를 확률변수 \textit{X}로 두었을 때, \textit{X}가 따르는 이산균등분포는 다음과 같이 나타낼 수 있다.
\[\textnormal{Pr}(X = x) = \frac{1}{k} \quad(x = 1,\cdots, k)\]
\textit{X}가 위의 이산균등분포를 따른다는 것을 줄여서 다음과 같이 나타낸다.
\[X \sim \textnormal{unif}\{1, k\}\]

\subsection{Expectation}
이산확률변수 \textit{X}가 가질 수 있는 값들을 $x_i \, (i = 1, \cdots)$, 각각의 값이 될 확률을 $p_i \, (i = 1, \cdots)$라고 할 때, \textit{X}의 기댓값(expectation)은 다음과 같다.
\[\textbf{E}[X] = \sum_{i} p_{i} x_{i}\]
사건 \textit{B}가 발생했다는 전제 하에서 사건 \textit{A}가 발생할 조건부확률(conditional probability)은 다음과 같다.
\[\textnormal{Pr}(A\,|\,B) = \frac{\textnormal{Pr}(A \cap B)}{\textnormal{Pr}(B)}\]
조건부확률의 정의를 이용하여 조건부기댓값(conditional expectation)을 정의할 수 있다. 사건 \textit{A}가 발생했다는 전제 하에서 이산확률변수 \textit{X}의 조건부기댓값은 다음과 같다.
\[\textbf{E}(X\,|\,A) = \sum_{x} x\,\textnormal{Pr}(X = x\,|\,A)\]
위 정의에서 합을 나타내는 시그마 기호는 \textit{X}의 범위 안에 포함되는 가능한 모든 \textit{x}에 대해 적용된다.

\subsection{\textit{k}-ary Tree}
\textit{k}진 트리(\textit{k}-ary tree)란 각각의 노드가 최대 \textit{k}개의 자식 노드를 가질 수 있는 트리 자료구조를 뜻한다. \textit{k}진 트리의 모든 노드가 0개 또는 \textit{k}개의 자식 노드를 갖는 경우 이를 정 \textit{k}진 트리(full \textit{k}-ary tree)라고 한다. 그리고 포화 \textit{k}진 트리(perfect \textit{k}-ary tree)는 모든 leaf가 root까지 도달하기 위한 간선의 개수, 다시 말해 깊이(depth)가 동일하며 또한 leaf를 제외한 모든 노드는 \textit{k}개의 자식 노드를 가지는 \textit{k}진 트리를 뜻한다. leaf에 해당하는 노드는 자식 노드의 수가 0이므로, 모든 포화 \textit{k}진 트리는 정 \textit{k}진 트리에 속한다.

트리 전체의 높이(height)란 트리 최하단에 위치하는 leaf의 깊이를 의미한다. 위에서 제시한 정의에 의해, 높이가 \textit{h}인 포화 \textit{k}진 트리의 최하단 leaf들의 전체 개수는 $k^h$개가 된다. Figure \ref{fig01}과 같이 높이가 3인 포화 4진 트리를 나타내는 그림을 그려보면 최하단에 위치한 leaf에 해당하는 노드의 개수가 총 $4^3$ = 64개임을 확인할 수 있다.

\begin{figure}[h]
\centering
\scalebox{0.5} {
\begin{forest}
for tree={
    circle,
    fill,
    minimum size=5.8pt,
    inner sep=0pt,
    outer sep=0pt
}
[
  [
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
  ]
  [
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
  ]
  [
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
  ]
  [
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
    [
      []
      []
      []
      []
    ]
  ]
]
\end{forest}
}
\caption{높이가 3인 포화 4진 트리}
\label{fig01}
\end{figure}

\section{Analysis}
\subsection{\textit{k}-ary Tree for Trial Rule}
어떤 동전을 던졌을 때 앞면, 뒷면이 나올 확률이 각각 $\frac{1}{2}$로 같다고 하자. 이 동전을 던져서 앞면이 나오는 사건과 뒷면이 나오는 사건에 각각 1, 2의 번호를 붙이고, 동전을 한 번 던졌을 때 발생하는 사건의 번호를 확률변수 \textit{X}로 두면 \textit{X}는 다음과 같이 이산균등분포를 따른다.

\singlespacing \[X \sim \textnormal{unif}\{1, 2\}\] \doublespacing

동전을 반복적으로 던지면 매 시행마다 \textit{X}의 값을 얻을 수 있다. 이제 어떤 정 이진트리(full binary tree)가 주어졌을 때, 해당 트리의 root에서 시작하여 leaf에 도달할 때까지 매번 동전을 던지는 시행을 통해 얻는 \textit{X}의 값에 따라 대응되는 간선으로 이동하며 한 단계씩 내려가는 규칙을 따른다고 생각해보자.

\begin{figure}[h]
\centering
\begin{forest}
for tree = {
    circle,
    minimum size=12pt,
    inner sep=0.1pt,
    calign=center,
    anchor=center,
}
[,fill
  [,fill, edge={->, >=latex}, edge label={node[pos=0.3pt,left,font=\footnotesize]{1}}
    [A, draw, edge={->, >=latex}, edge label={node[pos=0.3pt,left,font=\footnotesize]{1}}]
    [,fill, edge={->, >=latex}, edge label={node[pos=0.3pt,right,font=\footnotesize]{2}}
      [B, draw, edge={->, >=latex}, edge label={node[pos=0.3pt,left,font=\footnotesize]{1}}]
      [C, draw, edge={->, >=latex}, edge label={node[pos=0.3pt,right,font=\footnotesize]{2}}]
    ]
  ]
  [D, draw, edge={->, >=latex}, edge label={node[pos=0.3pt,right,font=\footnotesize]{2}}]
]
\end{forest}
\caption{각 노드에서 왼쪽, 오른쪽 자식 방향 간선이 각각 1, 2에 대응되는 정 이진트리}
\label{fig02}
\end{figure}
Figure \ref{fig02}의 정 이진트리는 A부터 D까지 총 4개의 leaf를 가진다. 이 트리에서 앞에서 설명한 규칙을 따라 이동하면 최종적으로 4개의 leaf 중 하나에 도달하게 될 것이다. root에서 시작하여 각 leaf에 도달할 확률은 다음과 같다.

\begin{table}[h]
\centering
\begin{tabular}{cccccc}
\toprule
 & \rule{1cm}{0pt} & \rule{1cm}{0pt} & \rule{1cm}{0pt} & \rule{1cm}{0pt} & \rule{0.5cm}{0pt} \\[-\arraystretch\normalbaselineskip]
\textbf{도달한 leaf} & A & B & C & D & \textbf{계} \\
\midrule
\textbf{확률} & $\displaystyle \left(\frac{1}{2}\right)^2$ & $\displaystyle \left(\frac{1}{2}\right)^3$ & $\displaystyle \left(\frac{1}{2}\right)^3$ & $\displaystyle \frac{1}{2}$ & 1 \\
\bottomrule
\end{tabular}
\end{table}
\noindent도달한 leaf가 C인 경우 root로 돌아가 이동을 처음부터 다시 시작하고, 그 외의 경우(A, B, D)에는 이동을 종료하는 것으로 규칙을 정해보자. 그러면 최종적으로 이동을 종료하였을 때, 반드시 A, B, D 중 하나의 leaf 노드에서 멈추게 된다. root에서 출발하여 이동을 A, B에서 종료하는 사건을 ${E}_{1}$, D에서 종료하는 사건을 ${E}_{2}$라고 하자. ${E}_{1}$이 발생하려면 root에서 출발한 뒤 바로 A, B에 도달하거나, C에 도달하여 처음부터 다시 시작하는 것을 1회 이상 반복한 뒤 마지막에 A, B에 도달하여야 한다. 따라서 ${E}_{1}$이 발생할 확률은 다음과 같이 구할 수 있다.
\[
\begin{split}
\textnormal{Pr}(E_{1}) & = \left(\frac{1}{4} + \frac{1}{8}\right)
+ \left(\frac{1}{4} + \frac{1}{8}\right)\left(\frac{1}{8}\right)
+ \left(\frac{1}{4} + \frac{1}{8}\right)\left(\frac{1}{8}\right)^2 + \ldots \\
& = \sum_{i=0}^{\infty} \frac{3}{8}\left(\frac{1}{8}\right)^i = \frac{3}{8}\left(\frac{1}{1 - \frac{1}{8}}\right) = \,\frac{3}{7}
\end{split}
\]
같은 방식으로 ${E}_{2}$이 발생할 확률도 계산할 수 있다.
\[
\begin{split}
\textnormal{Pr}(E_{2}) & = \frac{1}{2}
+ \frac{1}{2}\left(\frac{1}{8}\right)
+ \frac{1}{2}\left(\frac{1}{8}\right)^2 + \ldots \\
& = \sum_{i=0}^{\infty} \frac{1}{2}\left(\frac{1}{8}\right)^i = \frac{1}{2}\left(\frac{1}{1 - \frac{1}{8}}\right) = \,\frac{4}{7}
\end{split}
\]

이산확률변수 \textit{Y}에 대하여 사건 $E_{1}$가 발생하면 $Y=1$, 사건 $E_{2}$가 발생하면 $Y=2$라고 정의하자. 그러면 \textit{Y}가 따르는 확률분포를 나타낸 표는 다음과 같다.

\begin{table}[h]
\centering
\begin{tabular}{cccc}
\toprule
 & \rule{0.8cm}{0pt} & \rule{0.8cm}{0pt} & \rule{0.4cm}{0pt} \\[-\arraystretch\normalbaselineskip]
\textit{Y} & 1 & 2 & \textbf{계} \\
\midrule
$\textnormal{Pr}(Y=y)$ & $\displaystyle \frac{3}{7}$ & $\displaystyle \frac{4}{7}$ & 1 \\
\bottomrule
\end{tabular}
\end{table}

Figure \ref{fig02}에서 각 leaf 노드를 A, B, C, D 대신 다음과 같이 표현하여 해당 노드에 도달한 순간 발생하는 사건을 나타낼 수 있다.
\begin{figure}[h]
\centering
\begin{forest}
for tree = {
    circle,
    minimum size=15pt,
    inner sep=0.1pt,
    calign=center,
    anchor=center,
}
[,fill
  [,fill, edge={->, >=latex}, edge label={node[pos=0.3pt,left,font=\footnotesize]{1}}
    [E1, draw, edge={->, >=latex}, edge label={node[pos=0.3pt,left,font=\footnotesize]{1}}]
    [,fill, edge={->, >=latex}, edge label={node[pos=0.3pt,right,font=\footnotesize]{2}}
      [E1, draw, edge={->, >=latex}, edge label={node[pos=0.3pt,left,font=\footnotesize]{1}}]
      [Re, draw, edge={->, >=latex}, edge label={node[pos=0.3pt,right,font=\footnotesize]{2}}]
    ]
  ]
  [E2, draw, edge={->, >=latex}, edge label={node[pos=0.3pt,right,font=\footnotesize]{2}}]
]
\end{forest}
\end{figure}

지금까지의 내용을 통해,

X가 이산균등분포를 따를 때, 시행을 한 번 할 때마다 X의 값이 결정된다.
root에서 시작, 시행 후 X의 값에 따라 해당하는 간선을 통해 자식 노드로 이동
도착 후
아무것도 적혀있지 않은 경우 - 방금 한 내용을 반복
Ev가 적혀있는 경우 - 종료
Re가 적혀있는 경우 - root로 이동하여 다시 시작

종료 시 Ev1, ..., Evn 중 한 군데에서 끝나게 되고, 각각의 확률 계산 가능

임의로 주어진 유리수 확률을 구현하는 트리 생성이 항상 가능하다 (존재성)

무기억성, Probability and Computing p22부터 32까지

E[X] 계산 공식

E[X] 줄이기가 목표

합치기 소개, 정 k진 트리 유지 E[X]가 이만큼 줄어든다

...

기댓값은 선형성(linearity)을 가지므로 이산확률변수 \textit{X}, \textit{Y}에 대해 다음이 성립한다.\cite{prob22}
\[\textbf{E}[X+Y] = \textbf{E}[X] + \textbf{E}[Y]\]

\section{Implement}
ex케이스들 몇가지, vector 등 자료구조 사용 및 출력 시 preorder순회 등 언급… / depth limit

\section{Conclusion}
양자컴퓨터 양자 난수 생성기
quantum random number gen qrng - uniform?
qubit 당 2의 n승 uniform : 원하는 확률 분포로 효율적으로 변환

%Bibliographic references
\begin{thebibliography}{99}
\bibitem{contents2021} 
한국콘텐츠진흥원, 『2021년 게임콘텐츠 제작지원 사업안내서』. 2021.
\bibitem{roger}
Roger Caillois, 『놀이와 인간』. 이상률 옮김, 문예출판사, 2018.
\bibitem{prob22}
Michael Mitzenmacher, Eli Upfal, \textit{Probability and Computing : Randomized Algorithms and Probabilistic Analysis}., Cambridge University Press, 2005, p. 22.

\end{thebibliography}

\end{document}
